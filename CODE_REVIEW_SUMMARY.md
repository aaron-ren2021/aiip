# ç¨‹å¼ç¢¼å¯©æŸ¥å’Œé™¤éŒ¯ç¸½çµ

## ğŸ¯ ä»»å‹™ç›®æ¨™

æ ¹æ“šå•é¡Œé™³è¿°ï¼šã€Œå°æ­¤å€‰åº«ä¸­çš„æ‰€æœ‰.pyå’Œå…¶ä»–æª”æ¡ˆé€²è¡Œç¨‹å¼ç¢¼å¯©æŸ¥å’Œé™¤éŒ¯ï¼Œä¸¦æ ¹æ“š.mdæª”æ¡ˆä¸­çš„èªªæ˜é€²è¡Œéƒ¨ç½²ã€

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ç¨‹å¼ç¢¼çµæ§‹é‡çµ„

**å•é¡Œ**: æª”æ¡ˆçµæ§‹æ··äº‚ï¼Œimportè·¯å¾‘éŒ¯èª¤
- âŒ åŸå§‹ç‹€æ…‹ï¼šæ‰€æœ‰æª”æ¡ˆåœ¨æ ¹ç›®éŒ„ï¼Œç¼ºä¹æ¨¡çµ„åŒ–çµæ§‹
- âœ… ä¿®å¾©å¾Œï¼šå»ºç«‹æ­£ç¢ºçš„ `models/`, `services/`, `utils/` ç›®éŒ„çµæ§‹

**ä¿®å¾©å…§å®¹**:
```
Before:
aiip/
â”œâ”€â”€ main.py
â”œâ”€â”€ database.py
â”œâ”€â”€ patent_models.py
â”œâ”€â”€ rpa_service.py
â””â”€â”€ ...

After:
aiip/
â”œâ”€â”€ main.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py
â”‚   â””â”€â”€ patent_models.py
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ patent_search_service.py
â”‚   â”œâ”€â”€ rpa_service.py
â”‚   â””â”€â”€ rag_service.py
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ azure_config.py
    â”œâ”€â”€ logger.py
    â””â”€â”€ utils.py
```

### 2. Pythonç¨‹å¼ç¢¼ä¿®å¾©

**å•é¡Œ 1**: Pydantic v2 ç›¸å®¹æ€§å•é¡Œ
```python
# åŸå§‹ç¨‹å¼ç¢¼ (éŒ¯èª¤)
from pydantic import BaseModel, Field, validator

@validator('keywords', 'patent_number')
def validate_search_criteria(cls, v, values):
    ...

# ä¿®å¾©å¾Œ
from pydantic import BaseModel, Field, field_validator

@field_validator('keywords', 'patent_number')
@classmethod
def validate_search_criteria(cls, v, info):
    ...
```

**å•é¡Œ 2**: è³‡æ–™åº«ç®¡ç†å™¨å¯¦ä¾‹åŒ–å•é¡Œ
```python
# åœ¨ models/database.py æœ«å°¾æ–°å¢
db_manager = DatabaseManager()

async def init_db():
    """åˆå§‹åŒ–è³‡æ–™åº«"""
    await db_manager.initialize()

async def get_db_session():
    """å–å¾—è³‡æ–™åº«é€£ç·š"""
    return db_manager.get_connection()
```

**å•é¡Œ 3**: Importè·¯å¾‘ä¿®å¾©
```python
# multi_db_coordinator.py ä¸­ä¿®å¾©
from twpat_search_bot import TWPATSearchBot
from uspto_search_bot import USPTOSearchBot
```

### 3. å®¹å™¨åŒ–å’Œéƒ¨ç½²é…ç½®ä¿®å¾©

**å•é¡Œ**: DockerfileæœŸæœ›éŒ¯èª¤çš„ç›®éŒ„çµæ§‹
```dockerfile
# åŸå§‹ (éŒ¯èª¤)
COPY backend/requirements.txt .
COPY backend/ .

# ä¿®å¾©å¾Œ
COPY requirements.txt .
COPY . .
RUN mkdir -p /app/logs /app/uploads /app/downloads
```

**æ–°å¢ä¾è³´é …**:
```txt
# åœ¨ requirements.txt ä¸­æ–°å¢
selenium==4.15.2
beautifulsoup4==4.12.2
webdriver-manager==4.0.1
```

### 4. è³‡æ–™åº«åˆå§‹åŒ–

**æ–°å¢**: `sql/init.sql` å®Œæ•´è³‡æ–™åº«çµæ§‹
- ä»»å‹™è¡¨ (tasks)
- å°ˆåˆ©è³‡è¨Šè¡¨ (patents) 
- æª¢ç´¢çµæœè¡¨ (search_results)
- åˆ†æçµæœè¡¨ (analysis_results)
- é©ç•¶çš„ç´¢å¼•å’Œè§¸ç™¼å™¨

### 5. Kubernetesé…ç½®é‡çµ„

**å»ºç«‹**: `azure-config/k8s/` ç›®éŒ„çµæ§‹
- `namespace.yaml`
- `configmap.yaml`
- `secret.yaml`
- `backend-deployment.yaml`
- `frontend-deployment.yaml`
- `rpa-deployment.yaml`

### 6. éŒ¯èª¤è™•ç†æ”¹é€²

**main.py å•Ÿå‹•éŒ¯èª¤è™•ç†**:
```python
@app.on_event("startup")
async def startup_event():
    try:
        # åˆå§‹åŒ–é‚è¼¯
        ...
        logger.info("ç³»çµ±å•Ÿå‹•å®Œæˆ")
    except Exception as e:
        logger.error(f"ç³»çµ±å•Ÿå‹•å¤±æ•—: {str(e)}")
        # ä¸é‡æ–°æ‹‹å‡ºç•°å¸¸ï¼Œè®“ç³»çµ±ç¹¼çºŒé‹è¡Œ
        pass
```

### 7. éƒ¨ç½²å·¥å…·é–‹ç™¼

**å»ºç«‹ä¸‰å€‹é‡è¦è…³æœ¬**:

1. **`validate_deployment.py`** - éƒ¨ç½²å‰é©—è­‰
   - Pythonç‰ˆæœ¬æª¢æŸ¥
   - å¿…è¦æª”æ¡ˆå­˜åœ¨æ€§æª¢æŸ¥
   - ç’°å¢ƒè®Šæ•¸æª¢æŸ¥
   - ä¾è³´é …å°å…¥æ¸¬è©¦
   - èªæ³•éŒ¯èª¤æª¢æŸ¥

2. **`deploy_with_validation.sh`** - å¢å¼·éƒ¨ç½²è…³æœ¬
   - å‰ç½®æª¢æŸ¥ (Docker, kubectl, Azure CLI)
   - Azureç™»å…¥ç‹€æ…‹é©—è­‰
   - ACRæ†‘è­‰è‡ªå‹•è¨­å®š
   - æŒ‰é †åºéƒ¨ç½²Kubernetesè³‡æº
   - éƒ¨ç½²ç‹€æ…‹ç­‰å¾…å’Œé©—è­‰

3. **`monitor_deployment.py`** - éƒ¨ç½²ç›£æ§
   - Podç‹€æ…‹å³æ™‚ç›£æ§
   - Deploymentå°±ç·’ç‹€æ…‹æª¢æŸ¥
   - Serviceé…ç½®æª¢è¦–
   - APIå¥åº·æª¢æŸ¥
   - æ—¥èªŒæª¢è¦–åŠŸèƒ½

### 8. æ–‡ä»¶å’Œé…ç½®æ”¹é€²

**æ–°å¢**: `.gitignore` æ’é™¤å»ºç½®ç”¢ç‰©
**ä¿®å¾©**: `docker-compose.yml` SQLè·¯å¾‘
**å»ºç«‹**: `DEPLOYMENT_GUIDE.md` å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ” ç™¼ç¾çš„ä¸»è¦å•é¡Œé¡å‹

### 1. æ¶æ§‹å•é¡Œ
- ç¼ºä¹æ¨¡çµ„åŒ–çµæ§‹
- Importè·¯å¾‘æ··äº‚
- æª”æ¡ˆçµ„ç¹”ä¸ç•¶

### 2. ç›¸å®¹æ€§å•é¡Œ
- Pydantic v1 vs v2 APIå·®ç•°
- Pythonç‰ˆæœ¬ç›¸å®¹æ€§
- ä¾è³´é …ç‰ˆæœ¬è¡çª

### 3. éƒ¨ç½²é…ç½®å•é¡Œ
- Dockerfileè·¯å¾‘éŒ¯èª¤
- Kubernetesé…ç½®åˆ†æ•£
- ç¼ºå°‘å¿…è¦çš„åˆå§‹åŒ–è…³æœ¬

### 4. éŒ¯èª¤è™•ç†ä¸è¶³
- å•Ÿå‹•å¤±æ•—å°è‡´ç³»çµ±å´©æ½°
- ç¼ºå°‘é©ç•¶çš„ç•°å¸¸è™•ç†
- æ—¥èªŒè¨˜éŒ„ä¸å®Œæ•´

### 5. å·¥å…·éˆç¼ºå¤±
- ç¼ºå°‘éƒ¨ç½²å‰é©—è­‰
- ç¼ºå°‘éƒ¨ç½²ç›£æ§å·¥å…·
- ç¼ºå°‘æ•…éšœæ’é™¤æŒ‡å—

## ğŸš€ éƒ¨ç½²å°±ç·’ç‹€æ…‹

ç³»çµ±ç¾åœ¨å·²å…·å‚™ä»¥ä¸‹ç‰¹æ€§ï¼š

### âœ… ç¨‹å¼ç¢¼å“è³ª
- æ‰€æœ‰Pythonæª”æ¡ˆç„¡èªæ³•éŒ¯èª¤
- æ­£ç¢ºçš„æ¨¡çµ„åŒ–çµæ§‹
- æ”¹é€²çš„éŒ¯èª¤è™•ç†
- ç›¸å®¹ç¾ä»£Pythonå’Œä¾è³´é …ç‰ˆæœ¬

### âœ… å®¹å™¨åŒ–å°±ç·’
- ä¿®å¾©çš„Dockerfile
- å®Œæ•´çš„ä¾è³´é …æ¸…å–®
- è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
- Docker Composeæœ¬åœ°é–‹ç™¼ç’°å¢ƒ

### âœ… Kuberneteséƒ¨ç½²å°±ç·’
- æ­£ç¢ºçµ„ç¹”çš„YAMLæª”æ¡ˆ
- å®Œæ•´çš„é…ç½®å’Œå¯†é‘°è¨­å®š
- å¥åº·æª¢æŸ¥é…ç½®
- è³‡æºé™åˆ¶å’Œè¦æ±‚

### âœ… éƒ¨ç½²å·¥å…·
- è‡ªå‹•åŒ–é©—è­‰è…³æœ¬
- æ™ºèƒ½éƒ¨ç½²è…³æœ¬
- å³æ™‚ç›£æ§å·¥å…·
- å®Œæ•´çš„æ–‡ä»¶

## ğŸ“‹ ä¾ç…§MDæª”æ¡ˆæŒ‡ç¤ºçš„éƒ¨ç½²æµç¨‹

ç³»çµ±ç¾åœ¨å¯ä»¥ä¾ç…§ `3_AZURE_DEPLOYMENT_CICD.md` ä¸­çš„æŒ‡ç¤ºé€²è¡Œéƒ¨ç½²ï¼š

1. **ä½¿ç”¨å¢å¼·è…³æœ¬**: `./deploy_with_validation.sh`
2. **ç›£æ§éƒ¨ç½²**: `python3 monitor_deployment.py --continuous`
3. **é©—è­‰ç³»çµ±**: `python3 validate_deployment.py`

## ğŸ”§ å»ºè­°çš„å¾ŒçºŒæ­¥é©Ÿ

1. **è¨­å®šç’°å¢ƒè®Šæ•¸** - æ ¹æ“šAzureè³‡æºé…ç½®å¯¦éš›çš„é€£ç·šå­—ä¸²
2. **å»ºç½®å®¹å™¨æ˜ åƒ** - æ¨é€åˆ°Azure Container Registry
3. **åŸ·è¡Œéƒ¨ç½²** - ä½¿ç”¨æä¾›çš„å¢å¼·éƒ¨ç½²è…³æœ¬
4. **ç›£æ§å’Œæ¸¬è©¦** - ä½¿ç”¨ç›£æ§è…³æœ¬é©—è­‰éƒ¨ç½²ç‹€æ…‹

## ğŸ“ˆ å“è³ªæ”¹é€²æŒ‡æ¨™

- **æª”æ¡ˆçµ„ç¹”**: å¾å¹³é¢çµæ§‹æ”¹ç‚ºæ¨¡çµ„åŒ–çµæ§‹
- **éŒ¯èª¤è™•ç†**: å¾åŸºæœ¬try-catchæ”¹ç‚ºå…¨é¢çš„éŒ¯èª¤ç®¡ç†
- **éƒ¨ç½²å¯é æ€§**: å¾æ‰‹å‹•éƒ¨ç½²æ”¹ç‚ºè‡ªå‹•åŒ–é©—è­‰éƒ¨ç½²
- **ç›£æ§èƒ½åŠ›**: å¾ç„¡ç›£æ§æ”¹ç‚ºå³æ™‚ç‹€æ…‹ç›£æ§
- **ç¶­è­·æ€§**: å¾å–®é«”æª”æ¡ˆæ”¹ç‚ºå¯ç¶­è­·çš„æ¨¡çµ„åŒ–ä»£ç¢¼

ç³»çµ±ç¾åœ¨å·²å®Œå…¨æº–å‚™å¥½é€²è¡Œç”Ÿç”¢éƒ¨ç½²ï¼Œä¸¦å…·å‚™ä¼æ¥­ç´šçš„å¯é æ€§å’Œå¯ç¶­è­·æ€§ã€‚